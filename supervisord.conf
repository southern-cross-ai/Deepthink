[supervisord]
nodaemon=true
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/run/supervisord.pid

[program:ollama_wrapper]
command=/bin/bash -c "ollama serve & sleep 15 && if ! ollama pull llama2; then echo 'Pull failed'; exit 1; fi && ollama run llama2"
autostart=true
autorestart=true
startretries=3
stopasgroup=true
killasgroup=true
stderr_logfile=/var/log/ollama_wrapper.err.log
stdout_logfile=/var/log/ollama_wrapper.out.log
exitcodes=0

[program:gradio]
command=python3 /app/gradio_app.py
autostart=true
autorestart=true
startretries=3
stderr_logfile=/var/log/gradio.err.log
stdout_logfile=/var/log/gradio.out.log
startsecs=5
depends_on=ollama_wrapper